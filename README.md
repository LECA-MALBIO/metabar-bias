# Readme : metabar-bias project

This project contains the data and analysis scripts linked to the paper:

The web site presenting data and methods of this manuscript is available at :

  - https://leca-malbio.github.io/metabar-bias/


***Towards quantitative DNA Metabarcoding: A method to overcome PCR amplification bias***

16/10/24: The paper is available as a preprint. Cite as:

*Towards quantitative DNA Metabarcoding: A method to overcome PCR amplification bias
Sylvain Moinard, Didier Piau, Frederic Laporte, Delphine Rioux, Pierre Taberlet, Eric Coissac, Christelle Gonindard-Melodelima
bioRxiv 2023.10.03.560640; doi: https://doi.org/10.1101/2023.10.03.560640*

## Directory contents

### `data`

#### `data/ddpcr`

ddPCR results generated by Quantasoft (BioRad) software:

- [`QMETABAR_MOINARD_120422_manual.csv`](data/ddpcr/QMETABAR_MOINARD_120422_manual.csv) : Plate 1.
- [`QMETABAR_MOINARD_140422_manual.csv`](data/ddpcr/QMETABAR_MOINARD_140422_manual.csv) : Plate 2.

#### `data/extraction`

- [`dosage_extraction_plantes.xlsx`](data/extraction/dosage_extraction_plantes.xlsx) : Information about plants extraction and DNA concentration.

#### `data/metabarcoding`

Some files are too large to be stored in this git but the pipeline allows to reproduce all these files with the [OBITools 4](http://metabarcoding.org/obitools4) softwares. The pipeline is shown in file [data_processing.Rmd](data_processing.html), section Metabarcoding data processing

##### The raw data

Raw paired-end sequencing data produced during metabarcoding experiment:

- community $M_T$ 
  - `220930_NB501850_A_L1-4_GWM-1746_R1.fastq.gz` : forward reads
  - `220930_NB501850_A_L1-4_GWM-1746_R2.fastq.gz` : reverse reads
- community $M_G$
  - `220930_NB501850_A_L1-4_GWM-1748_R1.fastq.gz` : forward reads
  - `220930_NB501850_A_L1-4_GWM-1748_R2.fastq.gz` : reverse reads
- community $M_U$
  - `220930_NB501850_A_L1-4_GWM-1750_R1.fastq.gz` : forward reads
  - `220930_NB501850_A_L1-4_GWM-1750_R2.fastq.gz` : reverse reads

Information about tags added during metabarcoding experiment:

- [`DEL0455463409_bis.csv`](data/metabarcoding/DEL0455463409_bis.csv) : Forward tags
- [`DEL0455483280_bis.csv`](data/metabarcoding/DEL0455483280_bis.csv) : Reverse tags

##### The raw data processing

Data is processed using the [OBITools version 4](http://metabarcoding.org/obitools4) software. All bash commands used to process the date are available in file [data_processing.Rmd](data_processing.html).

- `*.json` files contain all the information about the PCR plates.

  - [`ngs_filter_tube_G1_EC_QMETABAR_210722.json`](data/metabarcoding/ngs_filter_tube_G1_EC_QMETABAR_210722.json) : community $M_G$
  - [`ngs_filter_tube_T1_EC_QMETABAR_210722.json`](data/metabarcoding/ngs_filter_tube_T1_EC_QMETABAR_210722.json) : community $M_T$
  - [`ngs_filter_tube_U1_EC_QMETABAR_210722.json`](data/metabarcoding/ngs_filter_tube_U1_EC_QMETABAR_210722.json) : community $M_U$

- `*.ngsfilter` files are produced from `*.json` files:

  - [`GWM-1746_T1.ngsfilter`](data/metabarcoding/GWM-1746_T1.ngsfilter) : community $M_T$
  - [`GWM-1748_G1.ngsfilter`](data/metabarcoding/GWM-1748_G1.ngsfilter) : community $M_G$
  - [`GWM-1750_U1.ngsfilter`](data/metabarcoding/GWM-1750_U1.ngsfilter) : community $M_U$

- `*.demultiplex` : FASTQ files with metabarcode reads assigned to samples

  - XXXX VOIR AVEC SYLVAIN XXXX

- `*.uniq` : A FASTA dereplicated version of the three `*.demultiplex` files:

  - [`GWM_Sper01.uniq`](data/metabarcoding/GWM_Sper01.uniq) : include data from the three communities

- `*.grep` : A FASTA file without singleton, too short ($<25\;bp$), and too long ($> 75\;bp$) sequences:

  - [`GWM_Sper01.grep`](data/metabarcoding/GWM_Sper01.grep)

- `*.clean` FASTA file annotated for spurious PCR generated sequences: 

  - [`GWM_Sper01.clean`](data/metabarcoding/GWM_Sper01.clean)

#### `data/plants_info`

- [`new_plant_positive_control.xlsx`](data/plants_info/new_plant_positive_control.xlsx) : information about plant sampling and barcodes for the Sper01 marker.

#### `data/qpcr_sybr`

- [`qpcr_Quantification_Amplification_Results_SYBR.csv`](data/qpcr_sybr/qpcr_Quantification_Amplification_Results_SYBR.csv) : qPCR RFU data used to draw [Figure 1](Figures/Figure_1_saturation_models.pdf), generated by CFX Maestro Software (BioRad) from SybrGreen qPCR data.

#### `data/qpcr_taqman`

Data produced by CFX Maestro Software (BioRad) from Taqman qPCR data.

- [`taqman_SPER01_kinetics_res.csv`](data/qpcr_taqman/taqman_SPER01_kinetics_res.csv) : RFU data.
- [`taqman_SPER01_Cq_res.csv`](data/qpcr_taqman/taqman_SPER01_Cq_res.csv) : quantification data.

#### `data/export_to_julia`

This repository contains data formatted to be used in Julia.

Reads numbers:

- [`reads_G.csv`](data/export_to_julia/reads_G.csv) : community $M_G$
- [`reads_T.csv`](data/export_to_julia/reads_T.csv) : community $M_T$
- [`reads_U.csv`](data/export_to_julia/reads_U.csv) : community $M_U$

Initial quantity of target molecules:

- [`qty_initG.csv`](data/export_to_julia/qty_initG.csv) : community $M_G$
- [`qty_initT.csv`](data/export_to_julia/qty_initT.csv) : community $M_T$
- [`qty_initU.csv`](data/export_to_julia/qty_initU.csv) : community $M_U$

Simulated communities to produce [Supplementary Figure 3](Figures/FigSupp_3_simu_exp_log.pdf). Each file contains the composition of 100 communities of 13 species, with different initial quantities of molecules $M0_{tot}$.

- [`sim100_m0tot_1.csv`](data/export_to_julia/sim100_m0tot_1.csv) : $M0_{tot} = 2.5\;10^4$
- [`sim100_m0tot_2.csv`](data/export_to_julia/sim100_m0tot_2.csv) : $M0_{tot} = 2.5\;10^5$[^2]
- [`sim100_m0tot_3.csv`](data/export_to_julia/sim100_m0tot_3.csv) : $M0_{tot} = 2.5\;10^6$

#### `data/export_to_r`

This repository contains results produced in Julia that are then exported to R for further analysis.

`efficiencies_U_*.csv` files contain amplification efficiencies inferred from $M_U$ for different values of carrying capacity $K$. Species order is specified in [metabar_bias.Rmd](metabar_bias.html).

- [`efficiencies_U_K11.csv`](data/export_to_r/efficiencies_U_K11.csv) : $K = 1.2\;10^{11}$
- [`efficiencies_U_K12.csv`](data/export_to_r/efficiencies_U_K12.csv) : $K = 1.2\;10^{12}$
- [`efficiencies_U_K13.csv`](data/export_to_r/efficiencies_U_K13.csv) : $K = 1.2\;10^{13}$[^1]
- [`efficiencies_U_K14.csv`](data/export_to_r/efficiencies_U_K14.csv) : $K = 1.2\;10^{14}$

`prop_inferG_*.csv` files contain proportions in $M_G$ inferred with corresponding efficiencies (see above) for different values of carrying capacity $K$. Species order is specified in [metabar_bias.Rmd](metabar_bias.html).

- [`prop_inferG_K11.csv`](data/export_to_r/prop_inferG_K11.csv) : $K = 1.2\;10^{11}$
- [`prop_inferG_K12.csv`](data/export_to_r/prop_inferG_K12.csv) : $K = 1.2\;10^{12}$
- [`prop_inferG_K13.csv`](data/export_to_r/prop_inferG_K13.csv) : $K = 1.2\;10^{13}$[^1]
- [`prop_inferG_K14.csv`](data/export_to_r/prop_inferG_K14.csv) : $K = 1.2\;10^{14}$

`prop_inferT_*.csv` files contain proportions in $M_T$ inferred with corresponding efficiencies (see above) for different values of carrying capacity $K$. Species order is specified in [metabar_bias.Rmd](metabar_bias.html).

- [`prop_inferT_K11.csv`](data/export_to_r/prop_inferT_K11.csv) : $K = 1.2\;10^{11}$
- [`prop_inferT_K12.csv`](data/export_to_r/prop_inferT_K12.csv) : $K = 1.2\;10^{12}$
- [`prop_inferT_K13.csv`](data/export_to_r/prop_inferT_K13.csv) : $K = 1.2\;10^{13}$[^1]
- [`prop_inferT_K14.csv`](data/export_to_r/prop_inferT_K14.csv) : $K = 1.2\;10^{14}$


Inference results (proportions of each species) for 100 simulated communities used in [Supplementary Figure 3](Figures/FigSupp_3_simu_exp_log.pdf). Different initial quantities of molecules $M0_{tot}$.

- [`res_commu1.csv`](data/export_to_r/res_commu1.csv) : $M0_{tot} = 2.5\;10^4$
- [`res_commu2.csv`](data/export_to_r/res_commu2.csv) : $M0_{tot} = 2.5\;10^5$[^2]
- [`res_commu3.csv`](data/export_to_r/res_commu3.csv) : $M0_{tot} = 2.5\;10^6$

#### `data/processed_data`

These files are generated in [data_processing.Rmd](data_processing.html) to produce ready-to-use data in the main analysis file, [metabar_bias.Rmd](metabar_bias.html).

- [`dataddpcr.csv`](data/processed_data/dataddpcr.csv) : summarising ddPCR data.
- [`df_Sper01.csv`](data/processed_data/df_Sper01.csv) : processed metabarcoding data for the 13 species of interest
- [`extraction.csv`](data/processed_data/extraction.csv) : summarising DNA extraction data.
- [`quantification_taqman.csv`](data/processed_data/quantification_taqman.csv) : Taqman qPCR quantification results.
- [`taqman_kinetics.csv`](data/processed_data/taqman_kinetics.csv) : Taqman qPCR RFU kinetics.
- [`preparing_taqman.csv`](data/processed_data/preparing_taqman.csv) : information about the design of Taqman experiment.


### Data analysis

- [data_processing](data_processing.html) : This file is used to prepare the data for the analysis performed (source: [`data_processing.Rmd`](data_processing.Rmd)).

-  [metabar_bias](metabar_bias.html) : This is the main analysis file (source: [`metabar_bias.Rmd`](metabar_bias.Rmd)).

- [Taqman_design](Taqman_design.html) : This file is used to design Taqman qPCR probes for the three species chosen for this analysis (source [`Taqman_design.Rmd`](Taqman_design.Rmd)).

#### scripts_Julia

This repository contains the Julia files used to infer PCR efficiencies and proportions of the different species. Their use is specified in metabar_bias.Rmd.

- [`metabar_bias_functions.jl`](Julia_scripts/metabar_bias_functions.jl) : Simulation and optimization functions used in the inference files below.

- [`inference_efficiencies_ps.jl`](Julia_scripts/inference_efficiencies_ps.jl) : Inference of efficiencies ($\Lambda_s$) from $M_U$ data and then of proportions in $M_T$ and $M_G$. Allows to test inference with different values of carrying capacity $K$.

- [`inference_simulated_communities.jl`](Julia_scripts/inference_simulated_communities.jl) : Inference of proportions with simulated communities to produce [Supplementary Figure 3](Figures/FigSupp_3_simu_exp_log.pdf).

[^1]: which is the estimated value computed from reaction conditions
[^2]: as in community $M_U$
